<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SynergyForge Login</title>
</head>
<body>
  <h1>SynergyForge â€“ MSF Login</h1>
  <button id="login">Sign in with MSF</button>

  <script>
    // === FILL THESE ===
    const AUTH_URL = "https://hydra-public.prod.m3.scopelypv.com/oauth2/auth";
    const CLIENT_ID = "<<<YOUR_CLIENT_ID>>>";
    const REDIRECT_URI = `${location.origin}/oauth/callback`; // must match what you registered


    // PKCE helpers
    function randomString(len = 64) {
      const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";
      const arr = new Uint8Array(len);
      crypto.getRandomValues(arr);
      return Array.from(arr, n => chars[n % chars.length]).join("");
    }
    async function sha256base64url(input) {
      const enc = new TextEncoder().encode(input);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      const bytes = new Uint8Array(buf);
      let str = "";
      for (let i = 0; i < bytes.byteLength; i++) str += String.fromCharCode(bytes[i]);
      return btoa(str).replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "");
    }

    document.getElementById("login").onclick = async () => {
      const state = randomString(20);
      const verifier = randomString(64);
      const challenge = await sha256base64url(verifier);

      sessionStorage.setItem("msf_state", state);
      sessionStorage.setItem("msf_verifier", verifier);
      sessionStorage.setItem("msf_redirect", REDIRECT_URI);

      const url = new URL(AUTH_URL);
      url.searchParams.set("response_type", "code");
      url.searchParams.set("client_id", CLIENT_ID);
      url.searchParams.set("redirect_uri", REDIRECT_URI);
      url.searchParams.set("code_challenge", challenge);
      url.searchParams.set("code_challenge_method", "S256");
      url.searchParams.set("state", state);
      // If the docs require scopes, add them here:
      // url.searchParams.set("scope", "openid profile");

      location.href = url.toString();
    };
  </script>
</body>
</html>
